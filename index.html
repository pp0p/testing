<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Mini App Security Test</title>
</head>
<body>
    <h1>Telegram Mini App Security Test</h1>
    <button onclick="sendMessageToTelegram()">ğŸ“© Test PostMessage Injection</button>
    <button onclick="testOpenLink()">ğŸ–¥ï¸ Test XSS via openLink()</button>
    <button onclick="testCSRF()">âš ï¸ Test CSRF Attack</button>
    <button onclick="checkIframeBreakout()">ğŸ”“ Test Iframe Escape</button>
    <button onclick="testOpenRedirectMethod1()">ğŸ”— Test Open Redirect Method 1</button>
    <button onclick="testOpenRedirectMethod2()">ğŸ”— Test Open Redirect Method 2</button>
    <button onclick="testOpenRedirectMethod3()">ğŸ”— Test Open Redirect Method 3</button>
    <button onclick="testOpenRedirectMethod4()">ğŸ”— Test Open Redirect Method 4</button>

    <script>
        // ğŸš¨ 1. Listen for incoming messages from Telegram
        window.addEventListener("message", function(event) {
            console.log("ğŸ“© Received Message:", event.origin, event.data);

            // ğŸ›‘ Origin Spoofing Detection
            if (event.origin !== "https://web.telegram.org") {
                alert("âš ï¸ Possible origin bypass detected! Unexpected origin: " + event.origin);
            }

            // ğŸš¨ Check for Sensitive Data Exposure
            if (typeof event.data === "string" && event.data.includes("token")) {
                alert("ğŸ”´ Potential Sensitive Data Exposure: " + event.data);
            }
        });

        // ğŸš€ 2. Test PostMessage Injection
        function sendMessageToTelegram() {
            console.log("ğŸ“© Sending Message to Telegram...");
            parent.postMessage("Test from Mini App", "*"); // * should be restricted!
        }

        // âš¡ 3. Test XSS via openLink()
        function testOpenLink() {
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.openLink("javascript:alert('XSS Detected!')");
            } else {
                alert("âš ï¸ Telegram WebApp API not found.");
            }
        }

        // ğŸ­ 4. Test CSRF Attack
        function testCSRF() {
            let csrfPayload = {
                method: "sendMessage",
                chat_id: 123456789, // Change this to your Telegram User ID
                text: "CSRF Test Message!"
            };

            fetch("https://api.telegram.org/bot<TOKEN>/sendMessage", {
                method: "POST",
                body: JSON.stringify(csrfPayload),
                headers: { "Content-Type": "application/json" }
            }).then(response => response.json()).then(data => {
                console.log("CSRF Response:", data);
            }).catch(error => {
                console.error("CSRF Attack Failed:", error);
            });
        }

        // ğŸ”“ 5. Attempt Iframe Escape
        function checkIframeBreakout() {
            try {
                top.location = "https://evil.com";  // Should be blocked
                alert("âš ï¸ Iframe escape possible!");
            } catch (error) {
                alert("âœ… Iframe escape is blocked (Safe).");
            }
        }

        // ğŸš¨ Test Open Redirect Method 1 (URL with query parameter)
        function testOpenRedirectMethod1() {
            let redirectUrl = "https://evil.com";  // Malicious URL
            window.location.href = "https://example.com/redirect?url=" + encodeURIComponent(redirectUrl);
        }

        // ğŸš¨ Test Open Redirect Method 2 (Using JavaScript window.location)
        function testOpenRedirectMethod2() {
            let redirectUrl = "https://evil.com";  // Malicious URL
            window.location = redirectUrl;  // Direct redirection
        }

        // ğŸš¨ Test Open Redirect Method 3 (Using anchor tag with href)
        function testOpenRedirectMethod3() {
            let redirectUrl = "https://evil.com";  // Malicious URL
            let link = document.createElement("a");
            link.href = redirectUrl;
            link.target = "_blank";  // Open in new tab
            document.body.appendChild(link);
            link.click();  // Simulate a click on the link
        }

        // ğŸš¨ Test Open Redirect Method 4 (Using form submission)
        function testOpenRedirectMethod4() {
            let redirectUrl = "https://evil.com";  // Malicious URL
            let form = document.createElement("form");
            form.method = "GET";
            form.action = redirectUrl;
            document.body.appendChild(form);
            form.submit();  // Submit the form to redirect
        }
    </script>
</body>
</html>
